import{r as m,b as Q,u as $,d as X,c as ee}from"./cargo-document-index.5bedc9f1.js";import{O as te,e as ie,S as N,f as x,h as ae}from"./editor-model.31d571d3.js";var F=(n=>(n[n.VERTICAL_BREAKPOINT=900]="VERTICAL_BREAKPOINT",n[n.HORIZONTAL_BREAKPOINT=800]="HORIZONTAL_BREAKPOINT",n[n.ASSETS_PANEL_STANDARD_WIDTH=300]="ASSETS_PANEL_STANDARD_WIDTH",n[n.INSPECTOR_PANEL_STANDARD_WIDTH=300]="INSPECTOR_PANEL_STANDARD_WIDTH",n[n.INSPECTOR_PANEL_SMALL_PORTRAIT_HEIGHT=300]="INSPECTOR_PANEL_SMALL_PORTRAIT_HEIGHT",n[n.TOOLBAR_STANDARD_WIDTH=55]="TOOLBAR_STANDARD_WIDTH",n[n.HEADER_STANDARD_HEIGHT=60]="HEADER_STANDARD_HEIGHT",n[n.HEADER_SMALL_PORTRAIT_WIDTH=60]="HEADER_SMALL_PORTRAIT_WIDTH",n[n.HEADER_SMALL_PORTRAIT_HEIGHT=60]="HEADER_SMALL_PORTRAIT_HEIGHT",n[n.HEADER_SMALL_LANDSCAPE_WIDTH=60]="HEADER_SMALL_LANDSCAPE_WIDTH",n[n.HEADER_SMALL_LANDSCAPE_HEIGHT=60]="HEADER_SMALL_LANDSCAPE_HEIGHT",n[n.MIN_WINDOW_WIDTH=390]="MIN_WINDOW_WIDTH",n[n.MIN_WINDOW_HEIGHT=390]="MIN_WINDOW_HEIGHT",n[n.MARGIN_STANDARD=0]="MARGIN_STANDARD",n))(F||{});const V=.05;var se=(n=>(n.SmallPortrait="SmallPortrait",n.SmallLandscape="SmallLandscape",n.Standard="Standard",n))(se||{});const ge=[{family:"amboy-black",label:"Amboy Black",weight:"400",style:"normal"},{family:"amboy-inline",label:"Amboy Inline",weight:"400",style:"normal"},{family:"adobe-clean",label:"Adobe Clean 300",weight:"300",style:"normal"},{family:"adobe-clean",label:"Adobe Clean 400",weight:"400",style:"normal"},{family:"adobe-clean",label:"Adobe Clean 700",weight:"700",style:"normal"},{family:"adobe-clean",label:"Adobe Clean 900",weight:"900",style:"normal"},{family:"Futura",label:"Futura",weight:"normal",style:"normal"},{family:"Courier New",label:"Courier New",weight:"normal",style:"normal"},{family:"timberline",label:"Timberline",weight:"normal",style:"normal"},{family:"museo-slab",label:"Museo Slab",weight:"normal",style:"normal"},{family:"quimby-gubernatorial",label:"Quimby Gubernatorial",weight:"normal",style:"normal"},{family:"jaf-zalamander",label:"Jaf Zalamander",weight:"normal",style:"normal"},{family:"flood-std",label:"Flood Std",weight:"normal",style:"normal"},{family:"lust-script-display",label:"Lust Script",weight:"normal",style:"normal"},{family:"chuck",label:"Chuck",weight:"normal",style:"normal"},{family:"funkydori",label:"Funkydori",weight:"normal",style:"normal"},{family:"viktor-script",label:"Viktor Script",weight:"normal",style:"normal"},{family:"dunbar-low",label:"Dunbar Low",weight:"normal",style:"normal"},{family:"dunbar-tall",label:"Dunbar Tall",weight:"normal",style:"normal"},{family:"dunbar-tall-italic",label:"Dunbar Tall Italic",weight:"normal",style:"normal"},{family:"fairwater-deco-serif",label:"Fairwater Deco",weight:"normal",style:"normal"},{family:"fairwater-sailor-serif",label:"Fairwater Sailor",weight:"normal",style:"normal"},{family:"p22-flw-exhibition",label:"P22 FLW Exhibition",weight:"normal",style:"normal"}];function _e(n,e={}){n.dispatchEvent(new CustomEvent("editorEvent",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}class C{constructor({maxFPS:e=NaN,paused:t=!1,onResume:i=()=>{},onPause:s=()=>{},onTick:a=()=>{},onFrame:l=()=>{}}){this._maxFPS=e,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._lastTimeUpdated=0,this._now=0,this._frameDeltaTime=0,this._frame=0,this._minInterval=Number.isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=i,this._onPause=s,this._onTick=a,this._onFrame=l,t||this.resume()}resume(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=C.getTime(),this._onResume(),this.requestFrame())}pause(){this._isRunning&&(this._isRunning=!1,this._onPause(),window.cancelAnimationFrame(this._frame))}get currentTick(){return this._currentTick}get currentTimeSeconds(){return this._currentTime/1e3}get tickDeltaTimeSeconds(){return this._tickDeltaTime/1e3}get timeScale(){return this._timeScale}set timeScale(e){this._timeScale!==e&&(this._timeScale=e)}get isRunning(){return this._isRunning}requestFrame(){this._frame=window.requestAnimationFrame(()=>this.doFrame())}doFrame(){this._now=C.getTime(),this._frameDeltaTime=this._now-this._lastTimeUpdated,this._lastTimeUpdated=this._now,this._tickDeltaTime=this._frameDeltaTime*this._timeScale,this._currentTick+=1,this._currentTime+=this._tickDeltaTime,this._onTick(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),(Number.isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)&&this._onFrame(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),this._isRunning&&this.requestFrame()}static getTime(){return Date.now()}}async function ne(n){return await(await fetch(n)).blob()}function oe(n){const{values:e}=n;if(e.length>0){const{type:t}=e[0];return t}return console.warn("attempted to extract a value type from a semantic item with no values"),"number"}function de(n){return n.replace(/ /g,"_")}function le({target:n,graph:e,pack:t,mutableDataPointerToHeadState:i,graphInputDataAdjacency:s}){const a=i[n.id];e.adjacencyList[a]||(e.adjacencyList[a]=[]);const l=m();t.data[l]={type:"attribute",value:"image"};const r=m();t.data[r]={type:"attribute",value:"placement"};const o=m();e.adjacencyList[s].push(`${o}::object`),e.adjacencyList[`${o}::value`]=[],e.nodes[o]={type:"get-value",staticInput:{key:l}};const d=m();e.adjacencyList[s].push(`${d}::object`),e.adjacencyList[`${d}::value`]=[],e.nodes[d]={type:"get-value",staticInput:{key:r}};const _=m();e.adjacencyList[a].push(`${_}::imageDisplayNode`),e.adjacencyList[`${o}::value`].push(`${_}::image`),e.adjacencyList[`${_}::imageDisplayNode`]=[],e.nodes[_]={type:"replace-image",staticInput:{}};const T=m();e.adjacencyList[`${_}::imageDisplayNode`].push(`${T}::displayNode`),e.adjacencyList[`${d}::value`].push(`${T}::placement`),e.adjacencyList[`${T}::displayNode`]=[],e.nodes[T]={type:"set-placement",staticInput:{}},i[n.id]=`${T}::displayNode`}function re({target:n,graph:e,pack:t,mutableDataPointerToHeadState:i,graphInputDataAdjacency:s}){const a=i[n.id];e.adjacencyList[a]||(e.adjacencyList[a]=[]);const l=m();e.adjacencyList[a].push(`${l}::object`),e.adjacencyList[s].push(`${l}::values`),e.adjacencyList[`${l}::object`]=[],e.nodes[l]={type:"assign-values-to-object-data",staticInput:{}},i[n.id]=`${l}::object`}function J({target:n,graph:e,pack:t,mutableDataPointerToHeadState:i,graphInputDataAdjacency:s}){const a=i[n.id];e.adjacencyList[a]||(e.adjacencyList[a]=[]);const l=m();t.data[l]={type:"attribute",value:"src"};const r=m();e.adjacencyList[a].push(`${r}::object`),e.adjacencyList[`${r}::value`]=[],e.nodes[r]={type:"get-value-from-object-data",staticInput:{key:l}};const o=m();e.adjacencyList[s].push(`${o}::substanceConfig`),e.adjacencyList[`${r}::value`].push(`${o}::imageUrl`),e.adjacencyList[`${o}::filteredImageUrl`]=[],e.nodes[o]={type:"get-substance-filtered-image",staticInput:{}};const d=m();e.adjacencyList[`${o}::filteredImageUrl`]=[`${d}::value`],e.adjacencyList[a].push(`${d}::object`),e.adjacencyList[`${d}::object`]=[],e.nodes[d]={type:"set-value-to-object-data",staticInput:{key:l}},i[n.id]=`${d}::object`}function z({target:n,graph:e,pack:t,mutableDataPointerToHeadState:i,graphInputDataAdjacency:s,dataAttributeKey:a}){const l=i[n.id];e.adjacencyList[l]||(e.adjacencyList[l]=[]);const r=m();t.data[r]={type:"attribute",value:"data"};const o=m();t.data[o]={type:"attribute",value:a};const d=m();e.adjacencyList[l].push(`${d}::object`),e.nodes[d]={type:"get-value",staticInput:{key:r}};const _=m();e.adjacencyList[`${d}::value`]=[`${_}::object`],e.adjacencyList[s].push(`${_}::value`),e.nodes[_]={type:"set-value",staticInput:{key:o}};const T=m();e.adjacencyList[l].push(`${T}::object`),e.adjacencyList[`${_}::object`]=[`${T}::value`],e.nodes[T]={type:"set-value",staticInput:{key:r}},i[n.id]=`${T}::object`}function ce({target:n,graph:e,mutableDataPointerToHeadState:t,graphInputDataAdjacency:i}){const s=t[n.id];e.adjacencyList[s]||(e.adjacencyList[s]=[]);const a=m();e.adjacencyList[s].push(`${a}::imageDisplayNode`),e.adjacencyList[i].push(`${a}::image`),e.nodes[a]={type:"replace-image",staticInput:{}},t[n.id]=`${a}::imageDisplayNode`}function he({target:n,graph:e,pack:t,mutableDataPointerToHeadState:i,graphInputDataAdjacency:s,packInputAttributeKey:a}){const l=i[n.id];e.adjacencyList[l]||(e.adjacencyList[l]=[]);const r=m();t.data[r]={type:"attribute",value:a};const o=m();e.adjacencyList[l].push(`${o}::object`),e.adjacencyList[s].push(`${o}::value`),e.nodes[o]={type:"set-value-to-pack-inputs",staticInput:{key:r}},i[n.id]=`${o}::object`}const ue=["text","image"];async function me(n,e,t,i,s,a){var K;const o=s.state.nodes[i].data,d={id:m(),author:o.author,tool:o.tool,name:o.name,thumbnail:"",extraThumbnails:[],tags:o.tags,inputs:[],defaultGraphId:"",graphs:{},data:{}},_=`${d.id}::${te}`;`${d.id}${ie}`;const T=Object.keys(e),W=Object.entries(e).reduce((f,[u,g])=>f.concat(g.value==="disabled"?[]:[u]),[]),R={};e[N].value;const q=n[N].values.map(f=>f.value)[0],O={},P={},L={};let w=[];if(n[x]){const u=n[x].values.map(g=>g.artboardIds[0]);w.push(...u)}if(n[N]){const u=n[N].values.map(g=>g.artboardIds[0]);w.push(...u)}w=[...new Set(w)];for(let f=0;f<w.length;f++){const u=w[f];if(!L[u]){const g=await a(u,200);g.url&&(L[u]=g.url)}}for(let f=0;f<T.length;f++){const u=T[f],g=u===N,S=u===x,I=e[u],y=I.valueLabels||{};if(!g&&I.value==="disabled")continue;const A=n[u],k=de(u),G=`${d.id}::${k}`;R[u]=G;const E={id:k,label:I.label||u,type:oe(A),value:""};if(A.values.forEach(h=>{const c=h.artboardIds,b=g?h.value:m();P[h.uniquenessKey]=b,g||(d.data[b]={type:h.type,value:h.value}),!S&&c.length>0&&c.forEach(p=>{O[p]||(O[p]={}),(I.value==="select-state"||ue.indexOf(h.type)===-1)&&(O[p][k]=b)})}),I.value==="select-state"){E.options=[];for(let h=0;h<A.values.length;h++){const c=A.values[h],b=P[c.uniquenessKey],p=y[c.uniquenessKey]||c.label;h===0&&(E.value=b);const M={label:`${p}`,value:b};if(c.thumbnail)M.thumbnail=c.thumbnail;else if(c.type==="text style"){const{font:D,weight:j,style:H,size:U,letterSpacing:Y,alignment:B}=c.value;M.thumbnail=await Q(D,j,H)}else(S||g)&&L[c.artboardIds[0]]&&(M.thumbnail=L[c.artboardIds[0]]);E.options.push(M)}A.values.length<=1&&delete E.options}else if(g)E.hidden=!0,E.value=q;else{const h=A.values[0];if(h){const c=m();E.value=c,d.data[c]={type:h.type,value:h.value}}}d.inputs.push(E)}for(const[f,u]of Object.entries(O)){const g=`${f}::preset`,S=P[g];d.data[S]={type:"preset",value:JSON.parse(JSON.stringify(u))}}const Z=[...new Set(W.reduce((f,u)=>f.concat(n[u].targets.map(g=>g.id)),[]))];for(let f=0;f<w.length;f++){const u=w[f],g=u,S=s.getNode(u),I={},y={width:S.width,height:S.height,backgroundColor:S.color,nodes:{},adjacencyList:{}},A=R[N];A||console.warn("NO TEMPLATE OUPUT KEY FOUND FROM SEMANTIC INFERENCE DATA");const k={documentNodes:A};if(y.adjacencyList[A]=[],I[u]={type:"container",parentId:"",children:[...S.children],x:0,y:0,blendMode:S.blendMode,width:S.width,height:S.height,rotate:0,data:{}},!(typeof t.transparentBackground=="boolean"?t.transparentBackground:!0)){const h=S.data.color||"#FFFFFF",c=m();(K=I[u].children)==null||K.splice(0,0,c),I[c]={type:"rectangle",parentId:u,x:0,y:0,blendMode:S.blendMode,width:S.width,height:S.height,rotate:0,data:{color:h}}}console.log(S.blendMode),s.traverseSubtreeOfNode_PACK_STOP(u,({id:h,type:c,parentId:b,children:p,x:M,y:D,blendMode:j,width:H,height:U,rotate:Y,data:B})=>{const v=JSON.parse(JSON.stringify(B));v.originalSrc&&(v.src=v.originalSrc),delete v.originalSrc,delete v.substanceName,delete v.substance,delete v.substanceConfig,I[h]={type:c,parentId:b,children:[...p],x:M,y:D,width:H,height:U,rotate:Y,blendMode:j,data:v}});const E=Object.keys(I).filter(h=>Z.includes(h));E.forEach(h=>{const c=m(),b=m();d.data[b]={type:"string",value:h},y.nodes[c]={type:"get-value",staticInput:{key:b}};const p=`${c}::value`,M=`${c}::object`;y.adjacencyList[A].push(M),k[h]=p}),W.forEach(h=>{const c=n[h],b=R[h];c.values.length,y.adjacencyList[b]||(y.adjacencyList[b]=[]),c.targets.forEach(p=>{if(E.indexOf(p.id)===-1)return;const M=p.recipe.split(":-:");switch(M[0]){case"Text":z({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b,dataAttributeKey:"text"});break;case"Image Source":ce({target:p,graph:y,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b});break;case"Image And Placement":le({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b});break;case"Text Style":re({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b});break;case"Fill Color":z({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b,dataAttributeKey:"color"});break;case"Substance Filter":J({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b});break;case"Substance Filter Config Attribute":J({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b});break;case"Pack Input":he({target:p,graph:y,pack:d,mutableDataPointerToHeadState:k,graphInputDataAdjacency:b,packInputAttributeKey:M[1]});break}})}),E.forEach(h=>{const c=k.documentNodes,b=k[h],p=m();y.adjacencyList[c]||(y.adjacencyList[c]=[]),y.adjacencyList[b]||(y.adjacencyList[b]=[]),y.adjacencyList[c].push(`${p}::object`),y.adjacencyList[b].push(`${p}::value`);const M=m();d.data[M]={type:"id",value:h},y.nodes[p]={type:"set-value",staticInput:{key:M}},k.documentNodes=`${p}::object`}),d.data[g]={type:"template",value:I},y.adjacencyList[k.documentNodes]=[_],d.graphs[g]=y,f===0&&(d.defaultGraphId=g)}return d}class Te{constructor(e,t,i,s,a=()=>{}){this.gestureStartScale=0,this.pressedKeys={},this.clipboardSelections=[],this._itemAddedWithGestureId="",this.documentController=e,this.documentModel=t,this.editorModel=i,this.cargoPackIndexModel=s,this.renderCallback=a,this.clipboardDocumentState=t.state,this.headlessRenderer=new ae,this.ticker=new C({onFrame:this.handleTickerTick.bind(this),paused:!0}),this.editorModel.setViewportWidth(window.innerWidth),this.editorModel.setViewportHeight(window.innerHeight),this.editorModel.setOriginOffsetX(window.innerWidth/2),this.editorModel.setOriginOffsetY(window.innerHeight/2),this.editorModel.setTimelinePosition(0),this._boundKeyupHandler=this.handleKeyup.bind(this),this._boundKeydownHandler=this.handleKeydown.bind(this),this._boundResizeHandler=this.handleWindowResize.bind(this),this._boundWindowWheelEvents=this.handleWindowWheelEvents.bind(this),this._boundWebkitMultiTouchTrackpadStart=this.handleWebkitMultiTouchTrackpadStart.bind(this),this._boundWebkitMultiTouchTrackpadChange=this.handleWebkitMultiTouchTrackpadChange.bind(this),this._boundWebkitMultiTouchTrackpadEnd=this.handleWebkitMultiTouchTrackpadEnd.bind(this)}connectToDom(){window.addEventListener("keyup",this._boundKeyupHandler),window.addEventListener("keydown",this._boundKeydownHandler),window.addEventListener("resize",this._boundResizeHandler),window.addEventListener("wheel",this._boundWindowWheelEvents,{passive:!1}),window.addEventListener("gesturestart",this._boundWebkitMultiTouchTrackpadStart),window.addEventListener("gesturechange",this._boundWebkitMultiTouchTrackpadChange),window.addEventListener("gestureend",this._boundWebkitMultiTouchTrackpadEnd),this.handleWindowResize()}disconnectFromDom(){this.ticker.pause(),window.removeEventListener("keyup",this._boundKeyupHandler),window.removeEventListener("keydown",this._boundKeydownHandler),window.removeEventListener("resize",this._boundResizeHandler),window.removeEventListener("wheel",this._boundWindowWheelEvents),window.removeEventListener("gesturestart",this._boundWebkitMultiTouchTrackpadStart),window.removeEventListener("gesturechange",this._boundWebkitMultiTouchTrackpadChange),window.removeEventListener("gestureend",this._boundWebkitMultiTouchTrackpadEnd)}async deleteCargoPack(e){await this.cargoPackIndexModel.delete(e)}async asyncGetThumbnailForDisplayNode(e,t){const{width:i,height:s}=this.documentModel.getNode(e),a=Math.max(i,s),l=t/a,r=await this.getRenditionFileBlob(e,l);return await $(r)}async updateExistingPublishedPack(e){const{data:{publishedPackId:t}}=this.documentModel.getNode(e);if(t){const i=t;return await this.publishArtboardGroupAsPack(e,i)}}async publishArtboardGroupAsPack(e,t){const{children:i,data:{semanticParameterConfiguration:s,packBuildOptions:a}}=this.documentModel.getNode(e),l=this.documentController.semanticInferenceForScope(e);this.createMessage({type:"info",copy:"Publishing Cargo Pack..."},6e3);const r=await me(l,s,a,e,this.documentModel,this.asyncGetThumbnailForDisplayNode.bind(this));this.createMessage({type:"info",copy:"Pack JSON Created..."},5e3);for(let d=0;d<i.length;d++){const _=i[d],T=await this.asyncGetThumbnailForDisplayNode(_,600);d===0?r.thumbnail=T.url:r.extraThumbnails.push(T.url)}this.createMessage({type:"info",copy:"Pack Thumbnails Generated..."},4e3);const o=await this.cargoPackIndexModel.create(r,t);this.createMessage({type:"positive",copy:"Cargo Pack Published"},4e3),this.documentController.update(e,{data:{publishedPackId:o}}),await this.documentController.save()}async getRenditionDataUrl(e,t=1){const i=this.documentController.generateDisplayGraph();return await this.headlessRenderer.getRendition({displayGraph:i,rootId:e,scale:t})}async getRenditionFileBlob(e,t){const i=await this.getRenditionDataUrl(e,t);return X(i)}async getRenditionFileBlobForDisplayGraph(e,t,i){const s=await this.headlessRenderer.getRendition({displayGraph:e,rootId:t,scale:i});return X(s)}async downloadRendition(e,t){const i=this.documentModel.getNode(e),s=await this.getRenditionDataUrl(e,t),a=document.createElement("a");document.body.append(a),a.download=`${i.data.name||"rendition"} @${t.toString().replace(".",",")}x`,a.href=s,a.click(),a.remove()}async saveRenditionAsThumbnail(e){const{width:t,height:i}=this.documentModel.getNode(e),s=Math.max(t,i),a=600/s,l=await this.getRenditionFileBlob(e,a),r=await $(l);this.documentModel.setThumbnail(r.url),this.documentController.handleNewDocumentState(),this.createMessage({type:"positive",copy:"Primary Thumbnail Saved"},3e3)}async saveRenditionAsExtraThumbnail(e){const{width:t,height:i}=this.documentModel.getNode(e),s=Math.max(t,i),a=600/s,l=await this.getRenditionFileBlob(e,a),r=await $(l),{extraThumbnails:o}=this.documentModel._state,d=[...o,r.url];this.documentModel.setExtraThumbnails(...d),this.documentController.handleNewDocumentState(),this.createMessage({type:"positive",copy:"Added Extra Thumbnail"},3e3)}async reuploadSmallImageVariants(){var i,s;const e=this.documentModel.findAll(a=>a.type==="image"),t=[];for(let a=0;a<e.length;a++){const l=e[a],{data:{src:r,originalSrc:o}}=this.documentModel.getNode(l),d=[r,o];for(let _=0;_<d.length;_++){const T=d[_];T&&t.push(T)}}for(let a=0;a<t.length;a++){const l=t[a],r=((s=(i=l==null?void 0:l.split("/"))==null?void 0:i.pop())==null?void 0:s.replace(".png",""))||"";this.createMessage({type:"neutral",copy:`Uploading Small Thumbnail ${a+1} of ${t.length}`},2e3);const o=await ne(l);await ee(o,r)}this.createMessage({type:"positive",copy:`Uploaded ${t.length} small thumbnails`},3e3)}generateSemanticInferenceData(){const{selections:e}=this.editorModel._state;let t={};if(e.length===1){const i=e[0];this.documentModel.getNodeType(i)==="artboard-group"&&(t=this.documentController.semanticInferenceForScope(i))}return this.editorModel.setSemanticInferenceData(t),t}handleTickerTick(e,t,i){const{timelineDuration:s}=this.documentModel._state,{timelinePosition:a}=this.editorModel._state,l=Math.min(s,a+t);l>=s?(this.ticker.pause(),this.editorModel.setTimelinePosition(s)):this.editorModel.setTimelinePosition(l),this.renderCallback()}createMessage(e,t=2e3){const i=this.editorModel.addMessage(e);this.renderCallback(),setTimeout(()=>{this.editorModel.removeMessage(i),this.renderCallback()},t)}handleArtboardGroupSelected(e){this.generateSemanticInferenceData()}setSelection(...e){this.editorModel.setSelection(...e),this.updateStrokeDecorations(),this.handleNodesSelected(...e)}handleNodesSelected(...e){for(let t=0;t<e.length;t++){const i=e[t];switch(this.documentController.documentModel.getNodeType(i)){case"artboard-group":this.handleArtboardGroupSelected(i);break}}}handleKeydown(e){const{keyCode:t,metaKey:i,ctrlKey:s}=e;this.pressedKeys[t]=!0;let a=0,l=0;switch(t){case 86:if(i===!0||s===!0){const o=this.documentController.duplicateIdsFromDocumentState(this.clipboardSelections,this.clipboardDocumentState);this.setSelection(...o),this.renderCallback();const d=o.length;this.createMessage({type:"positive",copy:`Paste ${d} item${d===1?"":"s from clipboard"}`},3e3)}break;case 71:if(i===!0||s===!0){const o=this.editorModel._state.selections.length;this.documentController.groupSelections(),this.createMessage({type:"positive",copy:`Group ${o} item${o===1?"":"s"}`},3e3),e.preventDefault()}break;case 67:if(i===!0||s===!0){this.clipboardSelections=[...this.editorModel._state.selections],this.clipboardDocumentState=this.documentModel.state;const o=this.editorModel._state.selections.length;this.createMessage({type:"positive",copy:`Copy ${o} item${o===1?"":"s to clipboard"}`},3e3),e.preventDefault()}break;case 32:this.editorModel._state.isPanningMode===!1&&(this.editorModel.setIsPanningMode(!0),this.renderCallback());break;case 8:[...this.editorModel._state.selections].forEach(o=>{this.editorModel.removeAllStateForId(o),this.documentController.delete(o,!0)}),this.updateStrokeDecorations(),this.documentController.handleNewDocumentState(),this.renderCallback();break;case 27:const r=[];this.editorModel._state.selections.forEach(o=>{const d=this.documentModel.getNodeParentId(o);d&&r.indexOf(d)===-1&&r.push(d)}),r.length===1&&this.documentModel.getNodeType(r[0])==="container"?this.setSelection(...r):this.setSelection(),this.renderCallback();break;case 68:if(e.altKey===!0||e.ctrlKey===!0){const o=this.editorModel._state.selections.length,d=this.documentController.duplicateIdsFromDocumentState(this.editorModel._state.selections,this.documentModel.state);this.setSelection(...d),this.createMessage({type:"positive",copy:`Duplicate ${o} item${o===1?"":"s"}`},3e3),this.renderCallback()}break;case 37:case 38:case 39:case 40:t===37?l=-1:t===38?a=-1:t===39?l=1:t===40&&(a=1),e.shiftKey===!0&&(l*=10,a*=10),this.editorModel._state.selections.forEach(o=>{const{x:d,y:_}=this.documentModel._state.nodes[o];this.documentController.update(o,{x:d+l,y:_+a})}),this.renderCallback();break}}handleKeyup(e){this.pressedKeys[e.keyCode]=!1,e.keyCode===32&&this.editorModel._state.isPanningMode===!0&&(this.editorModel.setIsPanningMode(!1),this.renderCallback())}handleWindowResize(){const e=this.editorModel._state.debug?window.innerHeight-400:window.innerHeight,t=Math.max(F.MIN_WINDOW_HEIGHT,e),i=Math.max(F.MIN_WINDOW_WIDTH,window.innerWidth),s=this.editorModel._state.viewportWidth-i,a=this.editorModel._state.viewportHeight-t,l=this.editorModel._state.originOffsetX-s/2,r=this.editorModel._state.originOffsetY-a/2;this.editorModel.setViewportWidth(i),this.editorModel.setViewportHeight(t),this.editorModel.setOriginOffsetX(l),this.editorModel.setOriginOffsetY(r),this.renderCallback()}handleWindowWheelEvents(e){if(e.target.tagName==="PROTOTYPE-APP"){if(e.preventDefault(),e.ctrlKey||e.altKey||e.metaKey||e.shiftKey){const t=this.editorModel._state.renderScale,i=-e.deltaY*.01,s=Math.max(V,t+i),a=s/t,l=this.editorModel._state.originOffsetX-e.pageX,r=this.editorModel._state.originOffsetY-e.pageY,o=l*a-l,d=r*a-r;this.editorModel.setRenderScale(s),this.editorModel.setOriginOffsetX(this.editorModel._state.originOffsetX+o),this.editorModel.setOriginOffsetY(this.editorModel._state.originOffsetY+d)}else this.editorModel.setOriginOffsetX(this.editorModel._state.originOffsetX-e.deltaX*2),this.editorModel.setOriginOffsetY(this.editorModel._state.originOffsetY-e.deltaY*2);this.renderCallback()}}handleWebkitMultiTouchTrackpadStart(e){e.preventDefault(),e.stopPropagation(),this.gestureStartScale=this.editorModel._state.renderScale}handleWebkitMultiTouchTrackpadChange(e){e.preventDefault(),e.stopPropagation();const t=this.editorModel._state.renderScale,i=Math.max(V,this.gestureStartScale*e.scale),s=i/t,a=this.editorModel._state.originOffsetX-e.pageX,l=this.editorModel._state.originOffsetY-e.pageY,r=a*s-a,o=l*s-l;this.editorModel.setRenderScale(i),this.editorModel.setOriginOffsetX(this.editorModel._state.originOffsetX+r),this.editorModel.setOriginOffsetY(this.editorModel._state.originOffsetY+o),this.renderCallback()}handleWebkitMultiTouchTrackpadEnd(e){e.preventDefault(),e.stopPropagation(),this.gestureStartScale=1}targetForHoveringOverId(e){const{selections:t}=this.editorModel._state;let i=this.documentModel._state.nodes[e],s=e;for(;i;){const a=this.documentModel._state.nodes[i.parentId];if(!a)return s;if(a.children.find(o=>t.indexOf(o)!==-1)||t.indexOf(a.id)!==-1||a.type==="artboard"||a.type==="canvas"){s=i.id;break}i=a}return s}targetForTouchingId(e){const{selections:t}=this.editorModel._state;let i=this.documentModel._state.nodes[e],s=e;for(;i;){const a=this.documentModel._state.nodes[i.parentId];if(!a)return s;if(a.children.find(o=>t.indexOf(o)!==-1)||t.indexOf(i.id)!==-1||a.type==="artboard"||a.type==="artboard-group"||a.type==="canvas"){s=i.id;break}i=a}return s}updateStrokeDecorations(){const{hovers:e,selections:t}=this.editorModel._state,i=[];e.forEach(s=>i.push(this.targetForHoveringOverId(s))),this.editorModel.setSelectableHovers(...i)}handleGestureStartOnId(e,t,i){if(this.editorModel._state.isPanningMode)return;const s=this.targetForTouchingId(e);this.editorModel._state.selections.indexOf(s)>=0||(this.documentModel.getNodeType(s)!=="canvas"?(t?this.editorModel.addSelection(s):this.setSelection(s),this._itemAddedWithGestureId=i):t||this.setSelection(),this.updateStrokeDecorations(),this.renderCallback())}handleDoubleClickOnId(e,t,i){if(this.editorModel._state.isPanningMode)return;const s=this.targetForHoveringOverId(e);this.editorModel._state.selections.indexOf(s)>=0||(this.documentModel.getNodeType(s)!=="canvas"?(t?this.editorModel.addSelection(s):this.setSelection(s),this._itemAddedWithGestureId=i):t||this.setSelection(),this.updateStrokeDecorations(),this.renderCallback())}handleSingleClickOnId(e,t,i){const s=this.targetForTouchingId(e);t&&this.editorModel._state.selections.length>1&&this.editorModel._state.selections.indexOf(s)>=0&&i!==this._itemAddedWithGestureId&&(this.editorModel.removeSelection(s),this.editorModel.removeHover(s)),this.updateStrokeDecorations(),this.renderCallback()}activateToolbarSection(e){this.editorModel.setSelection(),this.editorModel.setActiveToolbarSection(e),this.renderCallback()}delegateEvent(e){switch(e.action||"none"){case"activate-toolbar-section":this.activateToolbarSection(e.data);break;case"layers-toggle":this.editorModel.setIsLayersPaletteOpen(!this.editorModel._state.isLayersPaletteOpen),this.renderCallback();break;case"set-render-scale":if(e.num===void 0)return;this.editorModel.setRenderScale(e.num),this.renderCallback();break;case"message":this.createMessage(e.data,e.num);break;case"add-loading":this.editorModel.addLoading(e.id),this.renderCallback();break;case"artboard-doubleclick":this.setSelection(e.id),this.renderCallback();break;case"artboard-touch":this.setSelection(),this.renderCallback();break;case"interaction-item-pointerout":this.editorModel.removeHover(e.id),this.updateStrokeDecorations(),this.renderCallback();break;case"interaction-item-pointerover":this.editorModel.addHover(e.id),this.updateStrokeDecorations(),this.renderCallback();break;case"interaction-item-doubleclick":if(!e.id)return;this.handleDoubleClickOnId(e.id,e.data.shiftKey,e.data.gestureId);break;case"interaction-item-singleclick":if(!e.id)return;this.handleSingleClickOnId(e.id,e.data.shiftKey,e.data.gestureId);break;case"interaction-item-gesturestart":if(!e.id)return;this.handleGestureStartOnId(e.id,e.data.shiftKey,e.data.gestureId);break;case"set-selections":if(!e.ids)return;this.setSelection(...e.ids),this.renderCallback();break;case"set-target-layers-panel-height":this.editorModel.setTargetLayersPanelHeight(e.value),this.renderCallback();break;case"timeline-set-value":this.editorModel.setTimelinePosition(e.value*5),this.renderCallback();break;case"timeline-pause":this.ticker.pause();break;case"timeline-playpause-toggle":this.ticker.isRunning?this.ticker.pause():(this.editorModel._state.timelinePosition===this.documentModel._state.timelineDuration&&this.editorModel.setTimelinePosition(0),this.ticker.resume());break;case"download-rendition":if(!e.id)return;this.downloadRendition(e.id,e.scale);break;case"save-rendition-as-thumbnail":if(!e.id)return;this.saveRenditionAsThumbnail(e.id);break;case"save-rendition-as-extra-thumbnail":if(!e.id)return;this.saveRenditionAsExtraThumbnail(e.id);break;case"reupload-small-image-variants":this.reuploadSmallImageVariants();break;case"publish-artboard-group-as-pack":this.publishArtboardGroupAsPack(e.id);break;case"update-existing-published-pack":this.updateExistingPublishedPack(e.id);break;case"delete-cargo-pack-from-index":this.deleteCargoPack(e.id);break}}}export{se as A,Te as C,F as D,ge as F,_e as e};
