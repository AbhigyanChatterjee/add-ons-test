import{g as A,b as d,s as U,$ as F,H as z,I as R}from"./vendor.6b255b86.js";import{R as Y,t as L,i as B,j as M}from"./editor-model.31d571d3.js";import"./cargo-document-index.5bedc9f1.js";var V=Object.defineProperty,H=Object.getOwnPropertyDescriptor,x=(c,e,a,s)=>{for(var t=s>1?void 0:s?H(e,a):e,o=c.length-1,i;o>=0;o--)(i=c[o])&&(t=(s?i(e,a,t):i(t))||t);return s&&t&&V(e,a,t),t};const X=500;class g extends U{constructor(){super(),this.displayGraph={},this.id="",this.scale=1,this.width=0,this.height=0,this._displayGraphVersion="",this._width=240,this._height=148,this._originOffsetX=0,this._originOffsetY=0,this.renderer=new Y({antialias:!0,resolution:2,backgroundAlpha:0}),this.throttledUpdateCanvasSize=L(this.updateCanvasSize.bind(this),X)}updateCanvasSize(){this.renderer.canvasSize={width:this.width,height:this.height}}shouldUpdate(e){let a=!1;if(e.has("displayGraph")){const{versionTag:s}=this.displayGraph;this._displayGraphVersion!==s&&(this._displayGraphVersion=s,a=!0)}if(e.has("id")&&(a=!0),e.has("scale")&&this.throttledUpdateCanvasSize(),(e.has("width")||e.has("height"))&&this.throttledUpdateCanvasSize(),a){const s=this.displayGraph.nodes[this.id];if(s){const{x:t,y:o,width:i,height:r}=s;console.log(`incoming: ${i}, ${r}`),i>r?this.scale=this.width/i:r>i?this.scale=this.height/r:this.width<this.height?this.scale=this.width/i:this.scale=this.height/r;const b=Math.round(i*this.scale),f=Math.round(r*this.scale);this._originOffsetX=(this.width-b)/2,this._originOffsetY=(this.height-f)/2,f!==this.height||this.width}}return a}render(){return this.renderer.displayGraph=this.displayGraph,this.renderer.rootId=this.id,this.renderer.origin={x:this._originOffsetX,y:this._originOffsetY},this.renderer.scale=this.scale,this.renderer.render(),F`<div style="width:${this.width}px;height:${this.height}px;">${this.renderer.canvas}</div>`}}g.styles=A`
    :host {
      display: inline-block;
      position: relative;
    }
    div {
      overflow: hidden;
    }
    canvas {
      display: inline-block;
      position: relative;
      transform: scale(0.5);
      transform-origin: top left;
    }
  `;x([d({type:Object})],g.prototype,"displayGraph",2);x([d({type:String})],g.prototype,"id",2);x([d({type:Number})],g.prototype,"scale",2);x([d({type:Number})],g.prototype,"width",2);x([d({type:Number})],g.prototype,"height",2);customElements.define("renderer-pack",g);var q=Object.defineProperty,K=Object.getOwnPropertyDescriptor,N=(c,e,a,s)=>{for(var t=s>1?void 0:s?K(e,a):e,o=c.length-1,i;o>=0;o--)(i=c[o])&&(t=(s?i(e,a,t):i(t))||t);return s&&t&&q(e,a,t),t};class w extends U{constructor(){super(),this.width=100,this.height=100,this.packConfig={},this.container=document.createElement("div")}updated(e){if(e.has("packConfig")){const t=[],o=[],i=this.packConfig.graphs[this.packConfig.defaultGraphId],r=this.packConfig.id,b=`inputs-${r}`,f=`outputs-${r}`,G=[],m=[],u=[];t.push({data:{id:b,label:"INPUTS"}});const T=[];let S="";this.packConfig.inputs.forEach(n=>{const p=`output-${r}::${n.id}`;T.push(p),t.push({data:{parent:b,id:p,label:n.label},classes:"outputport",grabbable:!1}),S&&u.push({top:S,bottom:p,gap:50}),S=p}),m.push(T),t.push({data:{id:f,label:"OUTPUTS"}});const E=`input-${r}::display_nodes`,P=`input-${r}::async_display_nodes`;t.push({data:{parent:f,id:E,label:"Display Nodes"},classes:"inputport",grabbable:!1}),t.push({data:{parent:f,id:P,label:"Async Display Nodes"},classes:"inputport",grabbable:!1}),u.push({top:E,bottom:P,gap:50}),m.push([E,P]);for(const[n,p]of Object.entries(i.nodes)){const v=p.staticInput,j=B(p.type),C=M(p.type);t.push({data:{id:n,label:`${p.type}`}});const h=[];let I="";j.forEach(y=>{const l=`input-${n}::${y}`;h.push(l);const O=v[y];let D=y;if(typeof O=="string"||typeof O=="number"){const $=this.packConfig.data[O];$&&(typeof $.value=="string"||typeof $.value=="number")?D+=` (${$.value})`:D+=` (${O})`}t.push({data:{parent:n,id:l,label:D,type:"round-rectangle"},classes:"inputport",grabbable:!1}),I&&u.push({top:I,bottom:l,gap:50}),I=l}),m.push(h);const _=[];let k="";C.forEach(y=>{const l=`output-${n}::${y}`;_.push(l),t.push({data:{parent:n,id:l,label:y,type:"round-tag"},classes:"outputport",grabbable:!1}),k&&u.push({top:k,bottom:l,gap:50}),k=l}),m.push(_),h.length>0&&_.length>0&&(G.push([h[0],_[0]]),u.push({left:h[0],right:_[0],gap:330}))}for(const[n,p]of Object.entries(i.adjacencyList)){const v=`output-${n}`;n.split("::")[0],p.forEach(C=>{const h=`input-${C}`;C.split("::")[0],o.push({data:{id:`${v}${h}`,source:v,target:h},grabbable:!1}),u.push({left:v,right:h,gap:200})})}z.use(R);var a=z({container:this.container,boxSelectionEnabled:!1,style:[{selector:"node",css:{shape:"data(type)",content:"data(label)","text-valign":"center","text-halign":"center",color:"#C93C26","background-color":"#C93C26"}},{selector:".inputport",css:{"text-valign":"center","text-halign":"right","text-margin-x":10,"text-wrap":"ellipsis","text-max-width":"200px"}},{selector:".outputport",css:{"text-valign":"center","text-halign":"left","text-margin-x":-10,"text-wrap":"ellipsis","text-max-width":"200px"}},{selector:":parent",css:{content:"data(label)","text-valign":"top","text-halign":"center","background-color":"#F8D557","border-color":"#EE8855","border-width":4,color:"#FFFFFF","text-margin-y":-6,"text-background-padding":"8px","text-background-opacity":1,"text-background-color":"#EE8855","text-background-shape":"roundrectangle"}},{selector:"edge",css:{"target-arrow-shape":"triangle","target-arrow-color":"#DB3CAB","curve-style":"unbundled-bezier","line-color":"#DB3CAB"}}],elements:{nodes:t,edges:o},layout:{name:"preset",padding:5}}),s=a.elements().layout({name:"fcose",quality:"proof",randomize:!0,animate:!1,samplingType:!0,sampleSize:20,nodeSeparation:200,edgeElasticity:n=>.015,initialEnergyOnIncremental:.5,alignmentConstraint:{vertical:m,horizontal:G},relativePlacementConstraint:u});s.run()}}render(){return F`
      ${this.container}
    `}disconnectedCallback(){super.disconnectedCallback()}}w.styles=A`
    div {
      width: 100%;
      height: 100%;
    }
  `;N([d({type:Number})],w.prototype,"width",2);N([d({type:Number})],w.prototype,"height",2);N([d({type:Object})],w.prototype,"packConfig",2);customElements.define("render-pack-graph",w);
